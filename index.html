<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SHIFT — Institutional / Modern A·B (Stacked)</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
/* ───────────────── TOKENS (Institutional defaults) ───────────────── */
:root{
  --ink:#0b1220; --ink-2:#475569; --ink-3:#64748b;
  --brand:#0b3b6e;     /* Primary */
  --accent:#0f766e;    /* Accent */
  --bg-start:#f6f8fb;  /* Background gradient */
  --bg-end:#edf2f7;
  --surface:#ffffff;   /* Card surface */
  --line:#e5e7eb;      /* Hairline borders */
  --radius:8px; --radius-sm:6px;
  --pad-card: clamp(14px, 1.8vw, 18px);
  --pad-rail: 14px;
  --kpi-pos:#16a34a; --kpi-neg:#dc2626;
}

/* Density (compact = tighter) */
body[data-density="compact"]{
  --radius:6px; --radius-sm:5px;
  --pad-card: clamp(10px,1.2vw,14px);
  --pad-rail:12px;
}

/* ───────────────── Base & layout guards ───────────────── */
*,:before,:after{box-sizing:border-box}
html,body{height:100%; overflow-x:hidden;} /* hard guard */
body{
  margin:0; color:var(--ink);
  font:15.5px/1.55 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  background:#f6f8fb;
}
img,svg,canvas,video{max-width:100%; height:auto; display:block;}
:focus-visible{outline:3px solid color-mix(in oklab, var(--brand), #ffffff 65%); outline-offset:3px; border-radius:8px;}
@media (prefers-reduced-motion:no-preference){ html{scroll-behavior:smooth} }

/* Single long gradient */
.bg{position:fixed; inset:0; z-index:-1; pointer-events:none;
  background:linear-gradient(160deg,var(--bg-start) 0%, var(--bg-start) 45%, var(--bg-end) 100%);
  background-size:100% 100%; background-attachment:fixed;
}

/* Container never uses 100vw (prevents scrollbar-width overflow) */
.container{ width:min(1280px, 100%); margin-inline:auto; padding-inline:clamp(12px,4vw,28px); }
section{ padding-block:clamp(20px,3.2vw,38px); }

/* ───────────────── Top bar ───────────────── */
.nav{position:sticky; top:0; z-index:80; background:var(--surface); border-bottom:1px solid var(--line)}
.nav-inner{display:flex; align-items:center; gap:18px; padding:10px 2px}
.logo{font:800 clamp(18px,2.2vw,22px) Inter; letter-spacing:.2px}
.nav-links{display:flex; gap:14px; margin-left:8px; flex:1; flex-wrap:wrap}
.nav-links a{padding:10px 12px; border-radius:6px; text-decoration:none; color:var(--ink-2); font-weight:700}
.nav-links a:hover{background:#f3f4f6; color:var(--ink)}
.cta{background:var(--brand); color:#fff; text-decoration:none; padding:10px 14px; border-radius:8px; font-weight:800}

/* A/B switcher button */
.ab-switch{
  margin-left:auto; display:flex; gap:8px; align-items:center;
  border:1px solid var(--line); background:#fff; border-radius:999px; padding:4px;
}
.ab-switch button{border:0; background:transparent; padding:8px 12px; border-radius:999px; font:800 12px Inter; cursor:pointer;}
.ab-switch button.active{background:var(--brand); color:#fff}

/* ───────────────── Header band ───────────────── */
.band{background:linear-gradient(180deg, #fff, #fff0 60%); border-bottom:1px solid var(--line);}
.band-inner{display:flex; align-items:end; gap:10px; padding-block:14px}
.tag{font-weight:800; letter-spacing:.08em; text-transform:uppercase; color:var(--ink-2); font-size:.78rem}
h1{font:800 clamp(20px,2.6vw,28px)/1.15 Inter; margin:0; letter-spacing:-.01em}
.crumb{color:var(--ink-3); font-weight:600}

/* ───────────────── Components ───────────────── */
.card{background:var(--surface); border:1px solid var(--line); border-radius:var(--radius); box-shadow:0 1px 0 rgba(2,6,23,.02);}
.pad{padding:var(--pad-card);}
.h3{font:800 18px/1.2 Inter; margin:0 0 10px; position:relative; padding-left:12px}
.h3::before{content:""; position:absolute; left:0; top:3px; bottom:3px; width:4px; border-radius:3px; background:var(--brand);}
.meta{color:var(--ink-3); font-size:.93rem}
.rule{border:0; border-top:1px solid var(--line); margin:12px 0}

.kpis{display:grid; grid-template-columns:repeat(4,1fr); gap:12px}
@media (max-width:960px){ .kpis{grid-template-columns:repeat(2,1fr)} }
@media (max-width:560px){ .kpis{grid-template-columns:1fr} }
.kpi{background:#fff; border:1px solid var(--line); border-radius:var(--radius); padding:12px}
.kpi .label{color:var(--ink-2); font-weight:700; font-size:.85rem}
.kpi .val{font:800 clamp(18px,2vw,22px) Inter}
.kpi .delta{font-weight:800; font-size:.85rem}
.kpi .delta.up{color:var(--kpi-pos)} .kpi .delta.down{color:var(--kpi-neg)}

/* Grids */
.grid-2{display:grid; gap:16px; grid-template-columns:1fr 1fr}
.grid-3{display:grid; gap:16px; grid-template-columns:repeat(3,1fr)}
@media (max-width:1100px){ .grid-3{grid-template-columns:repeat(2,1fr)} }
@media (max-width:720px){ .grid-3,.grid-2{grid-template-columns:1fr} }

/* Force single-column where needed */
.stacked{ grid-template-columns:1fr !important; }

/* Pills & badges */
.pill{display:inline-flex;align-items:center;justify-content:center;padding:7px 10px;border-radius:6px;font-weight:800;font-size:.86rem;border:1px solid var(--line);background:#f8fafc;color:#334155}
.pill.neutral{background:#fff7ed;color:#92400e;border-color:#fed7aa}
.pill.positive{background:#ecfdf5;color:#065f46;border-color:#99f6e4}
.badge{display:inline-block;padding:5px 9px;border-radius:6px;font-weight:800;font-size:.82rem;border:1px solid var(--line);background:#fff;color:#111827}
.badge.green{background:var(--accent);color:#fff;border-color:transparent}
.badge.yellow{background:#f59e0b;color:#111827;border-color:transparent}
.badge.gray{background:#e5e7eb;color:#111827;border-color:transparent}

/* Tables */
.table-wrap{border:1px solid var(--line); border-radius:8px; overflow:auto; background:#fff; max-height:360px}
.table{width:100%; border-collapse:collapse; min-width:720px}
.table th,.table td{ padding:11px 12px; border-bottom:1px solid var(--line); text-align:left }
.table th{ font-weight:800; color:var(--ink-2); background:#f8fafc }

/* Charts */
.chart{width:100%; height:240px; display:block}
.chart.small{height:200px}

/* Rails — NO mask (prevents overflow issues). Arrows are inside container. */
.rail-wrap{ overflow:hidden; position:relative; max-width:100%; }
.rail{
  display:grid; grid-auto-flow:column; grid-auto-columns:minmax(280px,1fr);
  gap:14px; overflow-x:auto; scroll-snap-type:x mandatory; padding:var(--pad-rail);
  border:1px solid var(--line); border-radius:var(--radius);
  background:#fff; scrollbar-width:thin;
}
.rail::-webkit-scrollbar{height:10px}
.rail::-webkit-scrollbar-thumb{background:#cbd5e1; border-radius:20px}
.mini{border:1px solid var(--line); border-radius:6px; background:#fff; box-shadow:0 1px 0 rgba(2,6,23,.04); scroll-snap-align:start}
.mini .th{height:110px;border-bottom:1px solid var(--line);background:#0f1827;display:flex;align-items:center;justify-content:center;color:#fff}
.mini .cp{padding:12px}
.mini h4{margin:0 0 6px;font:800 14.5px/1.25 Inter}
.mini .meta{font-size:.88rem}

.rail-btn{
  position:absolute; top:50%; translate:0 -50%;
  width:36px; height:36px; display:grid; place-items:center; border-radius:50%;
  border:1px solid var(--line); background:#fff; box-shadow:0 6px 18px rgba(2,6,23,.12);
  cursor:pointer; transition:opacity .2s ease; z-index:2;
}
.rail-btn[disabled]{opacity:.35; pointer-events:none}
.rail-btn.left{ left:12px } .rail-btn.right{ right:12px }

/* Footer */
footer{color:var(--ink-3); padding:40px 0 56px; text-align:center}

/* ─────────────── Theme Studio (floating) ─────────────── */
.theme-fab{
  position:fixed; right:18px; bottom:18px; z-index:90;
  width:50px; height:50px; border-radius:10px; border:1px solid var(--line);
  background:var(--brand); color:#fff; display:grid; place-items:center; cursor:pointer;
}
.theme-panel{
  position:fixed; right:18px; bottom:82px; width:min(370px,92vw);
  background:#fff; border:1px solid var(--line); border-radius:10px; box-shadow:0 18px 60px rgba(2,6,23,.18);
  padding:12px; z-index:90; display:none; max-width:calc(100% - 36px);
}
.theme-panel.open{display:block}
.theme-panel h4{margin:0 0 8px; font:800 15px Inter}
.theme-row{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:8px}
.theme-row label{font:700 12px Inter; color:var(--ink-2)}
.theme-row input[type="color"]{width:100%; height:38px; border-radius:8px; border:1px solid var(--line); background:#fff}
.theme-actions{display:flex; gap:8px; justify-content:space-between; align-items:center; flex-wrap:wrap}
.tbtn{padding:9px 10px; border-radius:8px; border:1px solid var(--line); background:#fff; font:700 12px Inter; cursor:pointer}
.tbtn.save{background:var(--brand); color:#fff; border-color:transparent}

/* Presets + Density */
.presets{display:flex; flex-wrap:wrap; gap:6px; align-items:center}
.preset{border:1px solid var(--line); background:#fff; border-radius:999px; padding:6px 10px; font:700 12px Inter; cursor:pointer}
.preset:hover{background:#f8fafc}
.switch{display:inline-flex; border:1px solid var(--line); border-radius:999px; overflow:hidden}
.switch button{padding:7px 10px; font:700 12px Inter; border:0; background:#fff; cursor:pointer}
.switch button.active{background:var(--brand); color:#fff}

/* ─────────────── MODERN GLASS THEME (A/B) ─────────────── */
body[data-skin="modern"]{
  --bg-start:#ecf3ff; --bg-end:#f7f9ff;
  --brand:#0f3fb0; --accent:#0bb39b;
}
body[data-skin="modern"] .nav{background:rgba(255,255,255,.7); backdrop-filter:saturate(160%) blur(8px);}
body[data-skin="modern"] .card{
  background:linear-gradient(180deg, rgba(255,255,255,.72), rgba(255,255,255,.6));
  border:1px solid rgba(255,255,255,.55); backdrop-filter:saturate(180%) blur(10px);
  box-shadow:0 10px 30px rgba(15,23,42,.08);
}
body[data-skin="modern"] .rail{background:linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.62));}
body[data-skin="modern"] .mini{box-shadow:0 8px 26px rgba(15,23,42,.08);}
body[data-skin="modern"] .cta{box-shadow:0 10px 20px rgba(15,23,42,.12);}
</style>
</head>
<body data-skin="institutional">
<div class="bg" aria-hidden="true"></div>

<nav class="nav">
  <div class="container nav-inner">
    <div class="logo">SHIFT</div>
    <div class="nav-links">
      <a href="#overview">Overview</a>
      <a href="#research">Research</a>
      <a href="#education">Education</a>
      <a href="#deepdive">Deep&nbsp;Dive</a>
    </div>

    <!-- A/B switcher -->
    <div class="ab-switch" role="group" aria-label="Theme A/B">
      <button id="btnInstitutional" class="active">Institutional</button>
      <button id="btnModern">Modern</button>
    </div>

    <a class="cta" href="#">Join for Free</a>
  </div>
</nav>

<header class="band">
  <div class="container band-inner">
    <span class="tag">Quantitative Tools</span>
    <h1>Dashboard</h1>
    <span class="crumb">/ A·B Demo</span>
  </div>
</header>

<main class="container">
  <!-- KPIs -->
  <section>
    <div class="kpis">
      <div class="kpi"><div class="label">Core4 YTD</div><div class="val">+12.3%</div><div class="delta up">+0.6% this month</div></div>
      <div class="kpi"><div class="label">Sharpe (1Y)</div><div class="val">1.28</div><div class="delta up">↑ improving</div></div>
      <div class="kpi"><div class="label">Max Drawdown (1Y)</div><div class="val">-7.9%</div><div class="delta down">–0.3% latest</div></div>
      <div class="kpi"><div class="label">BTC Beta</div><div class="val">0.62</div><div class="delta">stable</div></div>
    </div>
  </section>

  <!-- Overview -->
  <section id="overview" aria-label="Overview">
    <div class="grid-2">
      <article class="card pad">
        <h3 class="h3">Current Systematic Portfolio Allocations</h3>
        <div class="grid-2">
          <div class="card pad" style="border:1px dashed var(--line)"><div class="tag" style="margin-bottom:6px">Crypto Portfolio</div><canvas class="chart" id="pie1"></canvas></div>
          <div class="card pad" style="border:1px dashed var(--line)"><div class="tag" style="margin-bottom:6px">CORE4 Portfolio</div><canvas class="chart" id="pie2"></canvas></div>
        </div>
      </article>

      <article class="card pad">
        <h3 class="h3">Current Signals</h3>
        <div class="grid-2">
          <div>
            <div class="tag" style="margin-bottom:6px">Bitcoin Positioning</div>
            <div class="meta">Latest Signal Change: Aug 18, 2025</div>
            <div style="margin-top:10px"><span class="pill neutral">Neutral</span></div>
            <hr class="rule">
            <div class="tag" style="margin-bottom:6px">Market Regime</div>
            <div class="meta">Latest Risk-on/Risk-off Change: May 2025</div>
            <div style="margin-top:10px"><span class="pill positive">Risk-on Disinflation</span></div>
          </div>
          <div>
            <div class="tag" style="margin-bottom:6px">Fear & Greed</div>
            <canvas class="chart small" id="gauge"></canvas>
            <div class="meta" id="gaugeLabel" style="text-align:center; margin-top:6px">Now: Greed (72)</div>
          </div>
        </div>
      </article>
    </div>

    <article class="card pad" style="margin-top:16px">
      <h3 class="h3">Systematic Positioning Guide</h3>
      <div class="meta" style="margin-bottom:8px">Select Position Mode: <span class="badge gray">Long Only</span></div>
      <div class="table-wrap" role="region" aria-label="Positioning Guide">
        <table class="table">
          <thead><tr><th>Asset</th><th>Signal</th><th>Position</th><th>Asset</th><th>Signal</th><th>Position</th></tr></thead>
          <tbody>
            <tr><td>Bitwise 10 Crypto Index Fund</td><td><span class="badge green">bullish</span></td><td><span class="badge green">Long 100%</span></td><td>Bitcoin</td><td><span class="badge yellow">neutral</span></td><td><span class="badge gray">Long 50%</span></td></tr>
            <tr><td>ETH/BTC</td><td><span class="badge green">bullish</span></td><td><span class="badge green">Long 100%</span></td><td>XRP/BTC</td><td><span class="badge yellow">neutral</span></td><td><span class="badge gray">Long 50%</span></td></tr>
            <tr><td>Solana</td><td><span class="badge green">bullish</span></td><td><span class="badge green">Long 100%</span></td><td>Ethereum</td><td><span class="badge green">bullish</span></td><td><span class="badge green">Long 100%</span></td></tr>
            <tr><td>Cardano</td><td><span class="badge green">bullish</span></td><td><span class="badge green">Long 100%</span></td><td>XRP</td><td><span class="badge yellow">neutral</span></td><td><span class="badge gray">Long 50%</span></td></tr>
            <tr><td>Dogecoin</td><td><span class="badge yellow">neutral</span></td><td><span class="badge gray">Long 50%</span></td><td>SMH: Semiconductor ETF</td><td><span class="badge green">bullish</span></td><td><span class="badge green">Long 100%</span></td></tr>
          </tbody>
        </table>
      </div>
    </article>
  </section>

  <!-- Rails — NOW STACKED (always 1 column) -->
  <section id="research">
    <div class="grid-2 stacked" style="margin-top:16px">
      <article class="card pad">
        <h3 class="h3">Research & Insights</h3>
        <p class="meta" style="margin:0 0 10px">Evidence-based notes and structured views across regimes, risk, and positioning.</p>
        <div class="rail-wrap">
          <button class="rail-btn left" aria-label="Scroll left" data-target="rail-research">‹</button>
          <button class="rail-btn right" aria-label="Scroll right" data-target="rail-research">›</button>
          <div class="rail" id="rail-research"></div>
        </div>
      </article>

      <article class="card pad" id="education">
        <h3 class="h3">Education</h3>
        <p class="meta" style="margin:0 0 10px">Bite-sized modules on mechanics, risks, and strategies that matter.</p>
        <div class="rail-wrap">
          <button class="rail-btn left" aria-label="Scroll left" data-target="rail-learn">‹</button>
          <button class="rail-btn right" aria-label="Scroll right" data-target="rail-learn">›</button>
          <div class="rail" id="rail-learn"></div>
        </div>
      </article>
    </div>
  </section>

  <!-- Deep Dive -->
  <section id="deepdive">
    <div class="grid-2">
      <article class="card pad"><h3 class="h3">Gold</h3><canvas class="chart" id="gold"></canvas></article>
      <article class="card pad"><h3 class="h3">US Dollar Index</h3><canvas class="chart" id="dxy"></canvas></article>
    </div>
    <div class="grid-2" style="margin-top:16px">
      <article class="card pad">
        <h3 class="h3">Crypto Market Strength Index</h3>
        <div class="grid-2">
          <canvas class="chart" id="cmsi_osc"></canvas>
          <canvas class="chart" id="cmsi_btc"></canvas>
        </div>
      </article>
      <article class="card pad"><h3 class="h3">Economic Regime Model</h3><canvas class="chart" id="regime"></canvas></article>
    </div>
  </section>
</main>

<footer class="container">© 2025 SHIFT — A·B Showcase. All data illustrative.</footer>

<!-- Theme Studio -->
<button class="theme-fab" id="openStudio" title="Theme Studio" aria-label="Open Theme Studio">
  <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M12 8.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7Zm8 3.5a8 8 0 0 0-.15-1.52l2.04-1.59-2-3.46-2.46.99a8.03 8.03 0 0 0-2.63-1.52L14.3 2h-4.6l-.5 2.9a8.03 8.03 0 0 0-2.63 1.52l-2.46-.99-2 3.46 2.04 1.59A8 8 0 0 0 4 12c0 .52.05 1.03.15 1.52L2.1 15.1l2 3.46 2.46-.99c.78.66 1.67 1.2 2.63 1.52l.5 2.9h4.6l.5-2.9c.96-.32 1.85-.86 2.63-1.52l2.46.99 2-3.46-2.04-1.59c.1-.49.15-1 .15-1.52Z" stroke="#fff" stroke-width="1.6" stroke-linejoin="round"/></svg>
</button>

<aside class="theme-panel" id="studio" aria-label="Theme Studio">
  <h4>Theme Studio</h4>
  <div class="theme-row">
    <div><label for="brandPick">Primary (Brand)</label><input type="color" id="brandPick"></div>
    <div><label for="accentPick">Accent</label><input type="color" id="accentPick"></div>
  </div>
  <div class="theme-row">
    <div><label for="bgStartPick">Background Start</label><input type="color" id="bgStartPick"></div>
    <div><label for="bgEndPick">Background End</label><input type="color" id="bgEndPick"></div>
  </div>
  <div class="theme-actions" style="width:100%">
    <div class="presets">
      <span class="tbtn" style="pointer-events:none;border:0;font-weight:800;padding:0">Presets:</span>
      <button class="preset" data-preset="shift">SHIFT Classic</button>
      <button class="preset" data-preset="navy">Deep Navy</button>
      <button class="preset" data-preset="charcoal">Charcoal</button>
      <button class="preset" data-preset="emerald">Emerald</button>
    </div>
    <div class="switch" id="density">
      <button data-mode="cozy" class="active" aria-pressed="true">Cozy</button>
      <button data-mode="compact" aria-pressed="false">Compact</button>
    </div>
  </div>
  <div class="theme-actions">
    <div>
      <button class="tbtn" id="copyVars">Copy</button>
      <button class="tbtn" id="resetVars">Reset</button>
    </div>
    <button class="tbtn save" id="saveVars">Save</button>
  </div>
</aside>

<script>
/* ---------- helpers ---------- */
const $=s=>document.querySelector(s);
const root=document.documentElement;
function setVar(n,v){root.style.setProperty(n,v)}
function getVar(n){return getComputedStyle(root).getPropertyValue(n).trim()}
function toHex(c){const x=document.createElement('canvas').getContext('2d');x.fillStyle=c;return x.fillStyle}
function mix(a,b,t=.5){function h2r(h){h=h.replace('#','');if(h.length===3)h=[...h].map(x=>x+x).join('');const n=parseInt(h,16);return[(n>>16)&255,(n>>8)&255,n&255]}function r2h([r,g,b]){return'#'+[r,g,b].map(v=>v.toString(16).padStart(2,'0')).join('')}const A=h2r(toHex(a)),B=h2r(toHex(b));return r2h([0,1,2].map(i=>Math.round(A[i]*(1-t)+B[i]*t)))}

/* ---------- canvas ---------- */
function dpiCanvas(c){const dpr=window.devicePixelRatio||1;const r=c.getBoundingClientRect();c.width=Math.max(1,Math.round(r.width*dpr));c.height=Math.max(1,Math.round(r.height*dpr));const ctx=c.getContext('2d');ctx.setTransform(dpr,0,0,dpr,0,0);return ctx}
function drawPie(c,segs){const ctx=dpiCanvas(c);const {width,height}=c.getBoundingClientRect();const r=Math.min(width,height)/2-8,cx=width/2,cy=height/2;ctx.save();ctx.translate(cx,cy);let s=-Math.PI/2;segs.forEach(p=>{const e=s+(Math.PI*2)*(p.value/100);ctx.beginPath();ctx.moveTo(0,0);ctx.arc(0,0,r,s,e);ctx.closePath();ctx.fillStyle=p.color;ctx.fill();s=e;});ctx.beginPath();ctx.arc(0,0,r*0.68,0,Math.PI*2);ctx.globalCompositeOperation='destination-out';ctx.fill();ctx.restore()}
function drawGauge(c,val){const ctx=dpiCanvas(c);const {width,height}=c.getBoundingClientRect();const cx=width/2,cy=height*0.95;const r=Math.min(width*0.46,height*0.95);const red='#dc2626',amber='#f59e0b',green=getVar('--accent');ctx.lineWidth=14;ctx.lineCap='round';[[Math.PI,Math.PI*1.33,red],[Math.PI*1.33,Math.PI*1.66,amber],[Math.PI*1.66,Math.PI*2,green]].forEach(([a,b,col])=>{ctx.beginPath();ctx.strokeStyle=col;ctx.arc(cx,cy,r,a,b);ctx.stroke()});const ang=Math.PI+(Math.PI*(val/100));ctx.save();ctx.translate(cx,cy);ctx.rotate(ang);ctx.strokeStyle=getVar('--ink');ctx.lineWidth=3.5;ctx.beginPath();ctx.moveTo(-6,0);ctx.lineTo(r-10,0);ctx.stroke();ctx.fillStyle='#fff';ctx.beginPath();ctx.arc(0,0,9,0,Math.PI*2);ctx.fill();ctx.restore()}
function drawHeatSeries(c,seed=1){const ctx=dpiCanvas(c);const {width,height}=c.getBoundingClientRect();const pad=12,w=width-pad*2,h=height-pad*2;ctx.save();ctx.translate(pad,pad);const cols=['#dc2626','#f59e0b',getVar('--accent'),getVar('--accent'),'#dc2626',getVar('--accent')];let x=0;function rnd(){seed=(seed*9301+49297)%233280;return seed/233280}while(x<w){const bw=Math.max(10,40+Math.floor(rnd()*80));ctx.fillStyle=cols[Math.floor(rnd()*cols.length)];ctx.fillRect(x,0,bw,h);x+=bw}ctx.strokeStyle=getVar('--brand');ctx.lineWidth=2;ctx.beginPath();const steps=180;let y=h*0.6;for(let i=0;i<=steps;i++){const px=(i/steps)*w;const dy=Math.sin(i/8)+Math.cos(i/13)+Math.sin(i/5+seed);y=(h*0.55)-dy*18+(i/steps)*h*0.18;(i===0?ctx.moveTo:ctx.lineTo).call(ctx,px,y)}ctx.stroke();ctx.restore()}
function drawOsc(c){const ctx=dpiCanvas(c);const {width,height}=c.getBoundingClientRect();const pad=12,w=width-pad*2,h=height-pad*2;ctx.save();ctx.translate(pad,pad);ctx.strokeStyle='rgba(15,23,42,.18)';ctx.beginPath();ctx.moveTo(0,h/2);ctx.lineTo(w,h/2);ctx.stroke();ctx.strokeStyle=getVar('--brand');ctx.lineWidth=2;ctx.beginPath();for(let i=0;i<=w;i++){const y=h*0.5-Math.sin(i/18)*h*0.45-Math.cos(i/47)*h*0.15;(i===0?ctx.moveTo:ctx.lineTo).call(ctx,i,y)}ctx.stroke();ctx.restore()}
function drawRegime(c){const ctx=dpiCanvas(c);const {width,height}=c.getBoundingClientRect();const pad=26,w=width-pad*2,h=height-pad*2;ctx.save();ctx.translate(pad,pad);ctx.strokeStyle='rgba(15,23,42,.18)';ctx.beginPath();ctx.moveTo(0,h/2);ctx.lineTo(w,h/2);ctx.moveTo(w/2,0);ctx.lineTo(w/2,h);ctx.stroke();ctx.strokeStyle=getVar('--brand');ctx.lineWidth=2;ctx.beginPath();for(let t=0;t<=1;t+=0.02){const x=w*(0.5+0.35*Math.sin(t*Math.PI*2)*Math.exp(-t*0.2));const y=h*(0.6-0.35*Math.cos(t*Math.PI*2)*Math.exp(-t*0.2));(t===0?ctx.moveTo:ctx.lineTo).call(ctx,x,y)}ctx.stroke();ctx.setLineDash([6,6]);ctx.strokeStyle=getVar('--accent');ctx.beginPath();ctx.moveTo(w*0.78,h*0.38);ctx.lineTo(w*0.85,h*0.45);ctx.lineTo(w*0.88,h*0.55);ctx.stroke();ctx.setLineDash([]);ctx.restore()}

/* ---------- render ---------- */
const PIE1=()=>[{label:'Cash',value:30,color:mix(getVar('--brand'),'#ffffff',0.6)},{label:'Bitcoin',value:20,color:getVar('--brand')},{label:'Altcoins',value:50,color:getVar('--accent')}];
const PIE2=()=>[{label:'Stocks',value:60,color:getVar('--brand')},{label:'Gold',value:30,color:mix(getVar('--brand'),getVar('--accent'),0.35)},{label:'Cash',value:5,color:'#f59e0b'},{label:'Bitcoin',value:5,color:getVar('--accent')}];

function renderAll(){drawPie($('#pie1'),PIE1());drawPie($('#pie2'),PIE2());drawGauge($('#gauge'),72);drawHeatSeries($('#gold'),7);drawHeatSeries($('#dxy'),13);drawOsc($('#cmsi_osc'));drawHeatSeries($('#cmsi_btc'),21);drawRegime($('#regime'))}
let _rt; const rerender=()=>{clearTimeout(_rt); _rt=setTimeout(renderAll,120)}
window.addEventListener('resize',rerender); window.addEventListener('load',renderAll);

/* ---------- rails ---------- */
const R=[{t:"Macro Update: Do markets still have room to run?",d:"July 1, 2025"},{t:"Two most likely scenarios for economy & markets",d:"March 14, 2025"},{t:"Hyperfluid: The emerging DeFi chain",d:"February 2025"},{t:"Bitcoin positioning: Risk-on disinflation",d:"May 2025"}];
const L=[{t:"AI × Crypto: where innovations converge",d:"June 9, 2024"},{t:"Intents: The next breakthrough",d:"April 28, 2024"},{t:"Programming payment channels",d:"December 20, 2023"},{t:"Wallet security, done right",d:"October 2023"}];
function miniCard({t,d}){const el=document.createElement('article');el.className='mini';el.innerHTML=`<div class="th">●</div><div class="cp"><h4>${t}</h4><div class="meta">📅 ${d}</div></div>`;return el}
const rr=$("#rail-research"), rl=$("#rail-learn"); R.forEach(x=>rr.append(miniCard(x))); L.forEach(x=>rl.append(miniCard(x)));
function setupRail(id){const rail=document.getElementById(id);const left=document.querySelector(`.rail-btn.left[data-target="${id}"]`);const right=document.querySelector(`.rail-btn.right[data-target="${id}"]`);const step=()=>Math.max(240,Math.min(rail.clientWidth*0.85,600));const check=()=>{const tol=2;left.disabled=rail.scrollLeft<=tol;right.disabled=rail.scrollLeft+rail.clientWidth>=rail.scrollWidth-tol};left.addEventListener('click',()=>rail.scrollBy({left:-step(),behavior:'smooth'}));right.addEventListener('click',()=>rail.scrollBy({left:step(),behavior:'smooth'}));rail.addEventListener('scroll',check,{passive:true});window.addEventListener('resize',check);requestAnimationFrame(check)}
setupRail('rail-research'); setupRail('rail-learn');

/* ---------- Theme Studio + presets + density ---------- */
const studio=$('#studio'); $('#openStudio').addEventListener('click',()=>studio.classList.toggle('open'));
const inputs={brand:$('#brandPick'),accent:$('#accentPick'),bgStart:$('#bgStartPick'),bgEnd:$('#bgEndPick')};
function setTheme(t){if(t.brand)setVar('--brand',t.brand);if(t.accent)setVar('--accent',t.accent);if(t.bgStart)setVar('--bg-start',t.bgStart);if(t.bgEnd)setVar('--bg-end',t.bgEnd);renderAll()}
function syncInputs(){inputs.brand.value=toHex(getVar('--brand'));inputs.accent.value=toHex(getVar('--accent'));inputs.bgStart.value=toHex(getVar('--bg-start'));inputs.bgEnd.value=toHex(getVar('--bg-end'))}
Object.values(inputs).forEach(i=>i.addEventListener('input',()=>setTheme({brand:inputs.brand.value,accent:inputs.accent.value,bStart:inputs.bgStart?.value,bEnd:inputs.bgEnd?.value})));
const PRESETS={shift:{brand:'#0b3b6e',accent:'#0f766e',bgStart:'#f6f8fb',bgEnd:'#edf2f7'},navy:{brand:'#0a2540',accent:'#1f7a8c',bgStart:'#f3f6fb',bgEnd:'#e9eef6'},charcoal:{brand:'#1f2937',accent:'#3f8c6d',bgStart:'#f7f7f8',bgEnd:'#eceff3'},emerald:{brand:'#064e3b',accent:'#10b981',bgStart:'#f4fbf8',bgEnd:'#ebf7f3'}};
document.querySelectorAll('.preset').forEach(b=>b.addEventListener('click',()=>{setTheme(PRESETS[b.dataset.preset]);b.animate([{transform:'scale(1)'},{transform:'scale(1.05)'},{transform:'scale(1)'}],{duration:220,easing:'ease-out'})}));
const density=$('#density'); density.addEventListener('click',e=>{if(e.target.tagName!=='BUTTON')return;const m=e.target.dataset.mode;document.body.setAttribute('data-density',m==='compact'?'compact':'cozy');density.querySelectorAll('button').forEach(x=>x.classList.toggle('active',x.dataset.mode===m));density.querySelectorAll('button').forEach(x=>x.setAttribute('aria-pressed',x.classList.contains('active')));renderAll()});
$('#saveVars').addEventListener('click',()=>{const t={brand:getVar('--brand'),accent:getVar('--accent'),bgStart:getVar('--bg-start'),bgEnd:getVar('--bg-end'),density:document.body.getAttribute('data-density')||'cozy',skin:document.body.getAttribute('data-skin')||'institutional'};localStorage.setItem('shift_ab_theme',JSON.stringify(t));alert('Theme saved ✅')});
$('#resetVars').addEventListener('click',()=>{setTheme(PRESETS.shift);document.body.setAttribute('data-density','cozy');document.body.setAttribute('data-skin','institutional');localStorage.removeItem('shift_ab_theme');syncInputs();renderAll()});
$('#copyVars').addEventListener('click',()=>{const json=JSON.stringify({brand:getVar('--brand'),accent:getVar('--accent'),bgStart:getVar('--bg-start'),bgEnd:getVar('--bg-end'),density:document.body.getAttribute('data-density')||'cozy',skin:document.body.getAttribute('data-skin')||'institutional'},null,2);navigator.clipboard.writeText(json).then(()=>alert('Theme copied 📋'))});
const saved=localStorage.getItem('shift_ab_theme'); if(saved){try{const t=JSON.parse(saved);setTheme(t);document.body.setAttribute('data-density',t.density||'cozy');document.body.setAttribute('data-skin',t.skin||'institutional');}catch{}}
syncInputs();

/* ---------- A/B switcher ---------- */
const btnInst=$('#btnInstitutional'), btnMod=$('#btnModern');
function setSkin(s){document.body.setAttribute('data-skin',s);btnInst.classList.toggle('active',s==='institutional');btnMod.classList.toggle('active',s==='modern');renderAll()}
btnInst.addEventListener('click',()=>setSkin('institutional'));
btnMod.addEventListener('click',()=>setSkin('modern'));
</script>
</body>
</html>
